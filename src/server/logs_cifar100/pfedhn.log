Setting up a new session...
==================== ALGORITHM: pFedHN ====================                    
Experiment Arguments:                                                          
{                                                                              
    'model': 'lenet5',                                                         
    'dataset': 'cifar100',                                                     
    'seed': 42,                                                                
    'join_ratio': 0.1,                                                         
    'global_epoch': 200,                                                       
    'local_epoch': 5,                                                          
    'finetune_epoch': 0,                                                       
    'test_gap': 100,                                                           
    'eval_test': 1,                                                            
    'eval_train': 0,                                                           
    'local_lr': 0.01,                                                          
    'momentum': 0.0,                                                           
    'weight_decay': 0.0,                                                       
    'verbose_gap': 10,                                                         
    'batch_size': 32,                                                          
    'visible': 1,                                                              
    'global_testset': 0,                                                       
    'straggler_ratio': 0,                                                      
    'straggler_min_local_epoch': 1,                                            
    'external_model_params_file': '',                                          
    'use_cuda': 1,                                                             
    'save_log': 1,                                                             
    'save_model': 0,                                                           
    'save_fig': 1,                                                             
    'save_metrics': 1,                                                         
    'viz_win_name': None,                                                      
    'version': 'pfedhn',                                                       
    'embed_dim': -1,                                                           
    'hn_lr': 0.01,                                                             
    'embed_lr': None,                                                          
    'hn_momentum': 0.9,                                                        
    'hn_weight_decay': 0.001,                                                  
    'hidden_dim': 100,                                                         
    'hidden_num': 3,                                                           
    'norm_clip': 50,                                                           
    'dataset_args': {                                                          
        'dataset': 'cifar100',                                                 
        'client_num': 100,                                                     
        'fraction': 0.5,                                                       
        'seed': 42,                                                            
        'split': 'sample',                                                     
        'super_class': False,                                                  
        'alpha': 0.1,                                                          
        'least_samples': 40                                                    
    }                                                                          
}                                                                              
Files already downloaded and verified
Files already downloaded and verified
-------------------------- TRAINING EPOCH: 10 --------------------------       
client [77] (test)  loss: 4.6352 -> 4.4799   acc: 0.00% -> 29.15%              
client [81] (test)  loss: 4.5517 -> 4.4413   acc: 3.48% -> 23.42%              
client [21] (test)  loss: 4.7351 -> 4.5154   acc: 0.86% -> 21.04%              
client [68] (test)  loss: 4.5736 -> 4.4356   acc: 10.54% -> 28.75%             
client [93] (test)  loss: 4.6280 -> 4.5400   acc: 0.00% -> 12.59%              
client [31] (test)  loss: 4.6296 -> 4.4841   acc: 0.00% -> 17.36%              
client [20] (test)  loss: 4.6079 -> 4.4122   acc: 0.00% -> 40.79%              
client [59] (test)  loss: 4.7727 -> 4.5070   acc: 0.00% -> 31.94%              
client [48] (test)  loss: 4.6070 -> 4.5562   acc: 0.00% -> 11.11%              
client [34] (test)  loss: 4.6216 -> 4.5328   acc: 2.32% -> 3.97%               
-------------------------- TRAINING EPOCH: 20 --------------------------       
client [69] (test)  loss: 4.6211 -> 4.3752   acc: 0.00% -> 23.51%              
client [99] (test)  loss: 4.5904 -> 4.5451   acc: 0.64% -> 4.78%               
client [67] (test)  loss: 4.6380 -> 4.5177   acc: 0.00% -> 5.02%               
client [0] (test)  loss: 4.6248 -> 4.5601   acc: 0.00% -> 3.60%                
client [76] (test)  loss: 4.6366 -> 4.5015   acc: 0.00% -> 0.00%               
client [41] (test)  loss: 4.5752 -> 4.4530   acc: 1.67% -> 16.67%              
client [62] (test)  loss: 4.6501 -> 4.5269   acc: 0.00% -> 16.72%              
client [2] (test)  loss: 4.9312 -> 4.5226   acc: 0.00% -> 1.15%                
client [14] (test)  loss: 4.6074 -> 4.5655   acc: 1.18% -> 3.53%               
client [46] (test)  loss: 4.5600 -> 4.3705   acc: 0.00% -> 34.40%              
-------------------------- TRAINING EPOCH: 30 --------------------------       
client [24] (test)  loss: 4.6203 -> 4.4094   acc: 0.00% -> 17.49%              
client [68] (test)  loss: 4.5643 -> 4.3071   acc: 9.90% -> 28.75%              
client [57] (test)  loss: 4.6085 -> 4.4043   acc: 0.33% -> 10.56%              
client [17] (test)  loss: 4.6063 -> 4.4049   acc: 4.76% -> 9.52%               
client [54] (test)  loss: 4.6453 -> 4.3482   acc: 1.09% -> 32.88%              
client [23] (test)  loss: 4.7302 -> 4.5452   acc: 0.00% -> 8.98%               
client [35] (test)  loss: 4.6281 -> 4.4254   acc: 0.00% -> 21.33%              
client [59] (test)  loss: 4.6654 -> 4.3822   acc: 0.00% -> 31.94%              
client [31] (test)  loss: 4.5894 -> 4.2026   acc: 0.32% -> 18.01%              
client [9] (test)  loss: 4.5743 -> 4.3343   acc: 0.00% -> 7.85%                
-------------------------- TRAINING EPOCH: 40 --------------------------       
client [64] (test)  loss: 4.6008 -> 3.8565   acc: 0.00% -> 22.69%              
client [33] (test)  loss: 4.6071 -> 4.1698   acc: 1.12% -> 18.66%              
client [16] (test)  loss: 4.6401 -> 3.9102   acc: 0.00% -> 22.54%              
client [44] (test)  loss: 4.6256 -> 4.2586   acc: 0.65% -> 16.01%              
client [8] (test)  loss: 4.6230 -> 3.7640   acc: 0.32% -> 25.00%               
client [31] (test)  loss: 4.4836 -> 3.5079   acc: 1.29% -> 18.01%              
client [47] (test)  loss: 4.5507 -> 3.9361   acc: 10.90% -> 12.03%             
client [36] (test)  loss: 4.5831 -> 4.4066   acc: 0.35% -> 9.72%               
client [20] (test)  loss: 4.6611 -> 3.6435   acc: 0.00% -> 40.79%              
client [56] (test)  loss: 4.6031 -> 4.3763   acc: 0.50% -> 12.38%              
-------------------------- TRAINING EPOCH: 50 --------------------------       
client [4] (test)  loss: 5.0360 -> 2.8164   acc: 0.00% -> 23.89%               
client [60] (test)  loss: 4.9477 -> 3.8379   acc: 0.00% -> 11.54%              
client [28] (test)  loss: 5.2030 -> 3.5339   acc: 13.59% -> 16.03%             
client [25] (test)  loss: 4.6605 -> 3.1214   acc: 0.42% -> 18.57%              
client [58] (test)  loss: 4.9205 -> 3.0022   acc: 0.00% -> 18.67%              
client [44] (test)  loss: 5.0727 -> 3.2251   acc: 0.33% -> 16.67%              
client [39] (test)  loss: 4.7262 -> 3.3668   acc: 0.65% -> 5.18%               
client [29] (test)  loss: 4.9184 -> 3.1320   acc: 7.14% -> 21.71%              
client [3] (test)  loss: 4.9464 -> 3.0880   acc: 12.23% -> 21.10%              
client [84] (test)  loss: 4.8497 -> 3.2798   acc: 1.55% -> 24.22%              
-------------------------- TRAINING EPOCH: 60 --------------------------       
client [21] (test)  loss: 7.2309 -> 2.6524   acc: 0.00% -> 27.67%              
client [84] (test)  loss: 4.5868 -> 3.0028   acc: 0.00% -> 24.53%              
client [10] (test)  loss: 7.9920 -> 3.0162   acc: 0.00% -> 28.17%              
client [36] (test)  loss: 5.1135 -> 3.1778   acc: 0.00% -> 10.42%              
client [65] (test)  loss: 5.3248 -> 3.0879   acc: 0.00% -> 17.00%              
client [81] (test)  loss: 4.9548 -> 2.9469   acc: 0.00% -> 22.15%              
client [79] (test)  loss: 4.8301 -> 2.1843   acc: 0.28% -> 38.70%              
client [42] (test)  loss: 4.8938 -> 2.3580   acc: 1.95% -> 31.60%              
client [11] (test)  loss: 4.8903 -> 2.8966   acc: 1.23% -> 20.55%              
client [96] (test)  loss: 6.4998 -> 3.6515   acc: 0.00% -> 11.76%              
-------------------------- TRAINING EPOCH: 70 --------------------------       
client [8] (test)  loss: 5.5256 -> 2.8441   acc: 0.00% -> 16.99%               
client [53] (test)  loss: 4.5567 -> 2.9451   acc: 7.78% -> 19.16%              
client [52] (test)  loss: 4.3599 -> 3.1150   acc: 5.32% -> 15.61%              
client [42] (test)  loss: 3.9328 -> 2.3318   acc: 26.06% -> 28.34%             
client [69] (test)  loss: 5.3998 -> 1.9492   acc: 0.00% -> 45.89%              
client [59] (test)  loss: 4.3197 -> 2.3765   acc: 0.32% -> 39.68%              
client [7] (test)  loss: 5.6331 -> 2.7191   acc: 0.00% -> 17.15%               
client [26] (test)  loss: 5.6095 -> 3.3862   acc: 2.69% -> 17.69%              
client [49] (test)  loss: 4.7941 -> 2.9331   acc: 1.44% -> 30.17%              
client [98] (test)  loss: 4.7639 -> 3.2655   acc: 1.88% -> 18.75%              
-------------------------- TRAINING EPOCH: 80 --------------------------       
client [98] (test)  loss: 4.6089 -> 3.2855   acc: 2.19% -> 20.00%              
client [47] (test)  loss: 5.3611 -> 2.9070   acc: 0.38% -> 20.68%              
client [21] (test)  loss: 4.6091 -> 2.5875   acc: 2.59% -> 28.82%              
client [77] (test)  loss: 5.1333 -> 2.3324   acc: 0.94% -> 35.74%              
client [95] (test)  loss: 4.5743 -> 2.8068   acc: 6.27% -> 19.80%              
client [91] (test)  loss: 5.3898 -> 2.8059   acc: 0.00% -> 15.76%              
client [14] (test)  loss: 5.1025 -> 3.0010   acc: 0.59% -> 25.29%              
client [99] (test)  loss: 5.0088 -> 3.4407   acc: 2.23% -> 12.42%              
client [20] (test)  loss: 4.4745 -> 1.7867   acc: 7.24% -> 33.88%              
client [39] (test)  loss: 4.8448 -> 3.0345   acc: 2.27% -> 13.27%              
-------------------------- TRAINING EPOCH: 90 --------------------------       
client [52] (test)  loss: 5.4509 -> 2.9838   acc: 1.99% -> 21.26%              
client [62] (test)  loss: 4.5867 -> 2.7372   acc: 2.95% -> 26.56%              
client [71] (test)  loss: 4.6586 -> 3.3280   acc: 1.30% -> 11.69%              
client [97] (test)  loss: 4.6546 -> 3.4771   acc: 4.31% -> 14.22%              
client [30] (test)  loss: 4.6214 -> 3.2907   acc: 0.95% -> 12.34%              
client [88] (test)  loss: 4.9276 -> 2.9539   acc: 0.99% -> 21.85%              
client [60] (test)  loss: 4.8789 -> 2.9041   acc: 0.00% -> 21.79%              
client [82] (test)  loss: 4.8355 -> 2.6351   acc: 0.35% -> 31.83%              
client [91] (test)  loss: 5.2053 -> 2.9157   acc: 1.61% -> 16.72%              
client [57] (test)  loss: 4.9426 -> 3.0507   acc: 0.00% -> 20.13%              
-------------------------- TRAINING EPOCH: 100 --------------------------      
client [31] (test)  loss: 4.1226 -> 2.5727   acc: 6.11% -> 29.90%              
client [15] (test)  loss: 4.7948 -> 2.8919   acc: 1.90% -> 21.20%              
client [71] (test)  loss: 4.5504 -> 3.2502   acc: 1.95% -> 13.31%              
client [97] (test)  loss: 5.2537 -> 3.5468   acc: 0.86% -> 9.91%               
client [53] (test)  loss: 4.9628 -> 3.0793   acc: 1.80% -> 17.37%              
client [77] (test)  loss: 5.2574 -> 2.2874   acc: 2.82% -> 36.68%              
client [76] (test)  loss: 4.4007 -> 2.5052   acc: 2.33% -> 36.21%              
client [79] (test)  loss: 4.5976 -> 2.0056   acc: 11.30% -> 42.94%             
client [28] (test)  loss: 5.0847 -> 2.8723   acc: 1.05% -> 28.57%              
client [99] (test)  loss: 5.0877 -> 3.4019   acc: 2.55% -> 13.69%              
-------------------------- TRAINING EPOCH: 110 --------------------------      
client [97] (test)  loss: 4.7962 -> 3.1425   acc: 0.43% -> 15.52%              
client [86] (test)  loss: 5.0729 -> 2.6991   acc: 1.19% -> 25.67%              
client [34] (test)  loss: 4.2045 -> 2.7448   acc: 11.92% -> 19.54%             
client [73] (test)  loss: 4.6872 -> 3.1770   acc: 3.67% -> 18.33%              
client [5] (test)  loss: 4.9700 -> 2.7258   acc: 0.64% -> 22.68%               
client [96] (test)  loss: 4.6686 -> 3.1073   acc: 1.24% -> 13.62%              
client [22] (test)  loss: 4.4010 -> 2.7234   acc: 5.61% -> 21.50%              
client [60] (test)  loss: 4.6713 -> 2.7848   acc: 1.92% -> 23.08%              
client [66] (test)  loss: 4.9145 -> 3.1616   acc: 2.91% -> 11.33%              
client [83] (test)  loss: 5.0928 -> 2.0655   acc: 5.30% -> 42.38%              
-------------------------- TRAINING EPOCH: 120 --------------------------      
client [76] (test)  loss: 4.5264 -> 2.4586   acc: 1.00% -> 37.87%              
client [65] (test)  loss: 4.6333 -> 3.1619   acc: 2.43% -> 22.67%              
client [95] (test)  loss: 4.4668 -> 2.6157   acc: 1.65% -> 25.41%              
client [17] (test)  loss: 10.4387 -> 2.7720   acc: 0.00% -> 22.54%             
client [8] (test)  loss: 5.4789 -> 2.6128   acc: 1.28% -> 28.85%               
client [35] (test)  loss: 4.6225 -> 2.1897   acc: 0.67% -> 32.00%              
client [98] (test)  loss: 4.1424 -> 3.0732   acc: 5.62% -> 22.81%              
client [53] (test)  loss: 4.7915 -> 3.2804   acc: 2.40% -> 14.67%              
client [43] (test)  loss: 4.8470 -> 2.7776   acc: 3.03% -> 25.76%              
client [64] (test)  loss: 4.5900 -> 2.5185   acc: 1.12% -> 37.82%              
-------------------------- TRAINING EPOCH: 130 --------------------------      
client [21] (test)  loss: 4.3381 -> 2.4057   acc: 3.75% -> 26.51%              
client [88] (test)  loss: 4.8064 -> 2.7676   acc: 1.66% -> 25.17%              
client [38] (test)  loss: 4.8547 -> 2.4246   acc: 2.55% -> 32.01%              
client [3] (test)  loss: 5.5896 -> 2.8118   acc: 1.53% -> 30.28%               
client [5] (test)  loss: 4.4358 -> 2.5454   acc: 4.47% -> 30.67%               
client [41] (test)  loss: 4.3083 -> 2.8040   acc: 6.00% -> 22.00%              
client [7] (test)  loss: 4.1871 -> 2.3373   acc: 5.83% -> 31.07%               
client [37] (test)  loss: 4.7032 -> 2.5043   acc: 1.93% -> 24.12%              
client [45] (test)  loss: 6.4880 -> 2.4819   acc: 0.00% -> 32.00%              
client [47] (test)  loss: 5.4101 -> 2.8236   acc: 0.75% -> 22.56%              
-------------------------- TRAINING EPOCH: 140 --------------------------      
client [16] (test)  loss: 4.7749 -> 4.3572   acc: 4.23% -> 8.17%               
client [11] (test)  loss: 3.9909 -> 2.3957   acc: 11.35% -> 34.66%             
client [37] (test)  loss: 4.4160 -> 2.4755   acc: 5.14% -> 25.72%              
client [41] (test)  loss: 4.4256 -> 2.7806   acc: 3.33% -> 23.00%              
client [95] (test)  loss: 4.1336 -> 2.6237   acc: 4.29% -> 26.07%              
client [53] (test)  loss: 4.8762 -> 2.7271   acc: 2.99% -> 29.34%              
client [22] (test)  loss: 4.1136 -> 3.0084   acc: 7.48% -> 18.38%              
client [25] (test)  loss: 4.0684 -> 2.4619   acc: 8.44% -> 32.49%              
client [69] (test)  loss: 4.2917 -> 1.7709   acc: 5.38% -> 54.39%              
client [46] (test)  loss: 3.8494 -> 2.3372   acc: 17.60% -> 42.40%             
-------------------------- TRAINING EPOCH: 150 --------------------------      
client [47] (test)  loss: 4.5095 -> 2.6623   acc: 9.02% -> 27.82%              
client [69] (test)  loss: 4.3802 -> 1.7161   acc: 8.78% -> 55.81%              
client [82] (test)  loss: 4.3877 -> 2.6585   acc: 2.77% -> 33.56%              
client [45] (test)  loss: 5.1544 -> 2.3665   acc: 1.67% -> 32.00%              
client [7] (test)  loss: 4.2587 -> 2.2624   acc: 5.18% -> 33.01%               
client [50] (test)  loss: 4.3903 -> 2.3262   acc: 3.23% -> 41.22%              
client [35] (test)  loss: 4.2197 -> 2.1478   acc: 7.00% -> 33.67%              
client [24] (test)  loss: 4.8831 -> 2.5155   acc: 3.42% -> 36.88%              
client [15] (test)  loss: 4.8829 -> 2.7049   acc: 2.22% -> 26.27%              
client [58] (test)  loss: 3.9739 -> 2.4045   acc: 10.13% -> 27.85%             
-------------------------- TRAINING EPOCH: 160 --------------------------      
client [48] (test)  loss: 4.5030 -> 2.7210   acc: 0.65% -> 23.53%              
client [76] (test)  loss: 4.5502 -> 2.3279   acc: 1.66% -> 39.53%              
client [67] (test)  loss: 4.4623 -> 2.0801   acc: 2.82% -> 39.81%              
client [37] (test)  loss: 4.8001 -> 2.3892   acc: 1.29% -> 27.33%              
client [58] (test)  loss: 4.1248 -> 2.3371   acc: 7.59% -> 28.48%              
client [64] (test)  loss: 4.6841 -> 2.5801   acc: 2.24% -> 39.78%              
client [77] (test)  loss: 4.6674 -> 2.2246   acc: 3.13% -> 39.81%              
client [55] (test)  loss: 4.2769 -> 2.1192   acc: 5.90% -> 43.17%              
client [12] (test)  loss: 4.7228 -> 2.2590   acc: 4.61% -> 37.17%              
client [89] (test)  loss: 4.2981 -> 2.9004   acc: 9.17% -> 27.22%              
-------------------------- TRAINING EPOCH: 170 --------------------------      
client [84] (test)  loss: 5.8775 -> 2.4894   acc: 0.00% -> 35.40%              
client [51] (test)  loss: 4.1282 -> 2.4745   acc: 10.13% -> 28.43%             
client [8] (test)  loss: 4.4619 -> 2.2105   acc: 2.56% -> 40.38%               
client [18] (test)  loss: 4.5464 -> 2.0803   acc: 5.47% -> 45.31%              
client [94] (test)  loss: 3.8631 -> 2.4589   acc: 12.18% -> 39.10%             
client [81] (test)  loss: 4.3811 -> 2.6287   acc: 7.28% -> 31.96%              
client [3] (test)  loss: 3.9795 -> 2.6236   acc: 8.87% -> 30.58%               
client [11] (test)  loss: 3.5524 -> 2.3222   acc: 20.25% -> 35.28%             
client [95] (test)  loss: 3.9631 -> 2.3856   acc: 7.26% -> 34.32%              
client [67] (test)  loss: 3.9173 -> 2.0432   acc: 14.42% -> 38.87%             
-------------------------- TRAINING EPOCH: 180 --------------------------      
client [21] (test)  loss: 4.5411 -> 2.2364   acc: 3.75% -> 33.72%              
client [79] (test)  loss: 3.6672 -> 1.8587   acc: 15.25% -> 47.46%             
client [58] (test)  loss: 3.8773 -> 2.2246   acc: 12.03% -> 34.18%             
client [88] (test)  loss: 4.3052 -> 2.4713   acc: 6.95% -> 37.42%              
client [46] (test)  loss: 3.8640 -> 2.2893   acc: 20.00% -> 44.40%             
client [11] (test)  loss: 3.5793 -> 2.3872   acc: 20.55% -> 34.36%             
client [55] (test)  loss: 3.8513 -> 2.0385   acc: 16.77% -> 44.41%             
client [13] (test)  loss: 4.1171 -> 2.4034   acc: 14.29% -> 37.08%             
client [31] (test)  loss: 4.2737 -> 2.5278   acc: 7.07% -> 32.48%              
client [75] (test)  loss: 3.7242 -> 1.9306   acc: 17.28% -> 47.84%             
-------------------------- TRAINING EPOCH: 190 --------------------------      
client [19] (test)  loss: 4.2075 -> 2.4576   acc: 7.49% -> 29.32%              
client [7] (test)  loss: 4.1081 -> 2.1795   acc: 4.85% -> 35.28%               
client [57] (test)  loss: 3.7372 -> 2.2423   acc: 15.84% -> 44.88%             
client [13] (test)  loss: 3.8584 -> 2.3471   acc: 10.94% -> 37.99%             
client [43] (test)  loss: 4.1403 -> 2.5154   acc: 10.91% -> 33.94%             
client [91] (test)  loss: 5.8846 -> 2.7244   acc: 0.96% -> 30.55%              
client [10] (test)  loss: 4.5466 -> 2.6882   acc: 7.94% -> 36.11%              
client [64] (test)  loss: 4.9139 -> 2.4789   acc: 3.92% -> 39.78%              
client [82] (test)  loss: 4.3211 -> 2.7794   acc: 4.15% -> 32.53%              
client [22] (test)  loss: 3.9452 -> 2.4788   acc: 8.72% -> 27.73%              
-------------------------- TRAINING EPOCH: 200 --------------------------      
client [20] (test)  loss: 5.7586 -> 2.4700   acc: 9.54% -> 29.61%              
client [23] (test)  loss: 4.3012 -> 2.4291   acc: 4.30% -> 35.55%              
client [88] (test)  loss: 4.1517 -> 2.4245   acc: 10.26% -> 39.40%             
client [98] (test)  loss: 4.1896 -> 2.7018   acc: 13.75% -> 32.19%             
client [79] (test)  loss: 4.1665 -> 1.7739   acc: 3.95% -> 49.72%              
client [21] (test)  loss: 4.7771 -> 2.1909   acc: 6.05% -> 34.01%              
client [92] (test)  loss: 3.9758 -> 2.7991   acc: 12.55% -> 27.62%             
client [56] (test)  loss: 4.2125 -> 3.0999   acc: 10.40% -> 29.70%             
client [5] (test)  loss: 5.3074 -> 2.2604   acc: 4.79% -> 39.94%               
client [52] (test)  loss: 4.3351 -> 3.5012   acc: 6.98% -> 28.24%              
Training... ---------------------------------------- 100% 0:07:04
==================== pFedHN TEST RESULTS: ====================                 
{                                                                              
    100: {'loss': '4.7732 -> 0.0000', 'accuracy': '1.96% -> 0.00%'},           
    200: {'loss': '4.3479 -> 0.0000', 'accuracy': '7.39% -> 0.00%'}            
}                                                                              
Convergence (test_before):                                                     
pFedHN achieved 10.0%(13.24%) at epoch: 179                                    
Convergence (test_after):                                                      
pFedHN achieved 10.0%(13.92%) at epoch: 0                                      
pFedHN achieved 20.0%(20.27%) at epoch: 1                                      
pFedHN achieved 30.0%(30.37%) at epoch: 54                                     
